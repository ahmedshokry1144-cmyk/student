<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø§ÙÙˆÙƒØ§ØªÙˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body{
  font-family:'Cairo';
  background:linear-gradient(135deg,#eef2f7,#dfe9f3);
  margin:0;
}

/* ====== HEADER ====== */
header{
  text-align:center;
  padding:25px;
  background:#2a5298;
  color:#fff;
}

/* ====== PAGES ====== */
.page{display:none;padding:20px}
.active{display:block}

/* ====== GROUPS ====== */
.groups{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:25px;
  perspective:1200px;
}

.group{
  background:linear-gradient(135deg,#ff8fa3,#ff3d6f);
  color:#fff;
  padding:30px 20px;
  border-radius:20px;
  text-align:center;
  cursor:pointer;
  font-weight:700;
  transition:all .6s ease;
  transform-style:preserve-3d;
  box-shadow:0 15px 30px rgba(0,0,0,.2);
}

.group i{
  font-size:3rem;
  display:block;
  margin-bottom:10px;
  transition:all .6s ease;
  transform:translateZ(30px);
}

/* Hover 3D */
.group:hover{
  transform:rotateY(20deg) rotateX(10deg) scale(1.08);
  background:linear-gradient(135deg,#00c6ff,#0072ff);
}

.group:hover i{
  transform:rotate(360deg) translateZ(50px);
  color:#ffe600;
}

/* Selected */
.group.selected{
  background:linear-gradient(135deg,#4caf50,#2e7d32);
}

.group.selected i{
  animation:spin 3s linear infinite;
  color:#fff;
}

@keyframes spin{
  from{transform:rotateY(0deg) translateZ(40px)}
  to{transform:rotateY(360deg) translateZ(40px)}
}

/* ====== TABLE ====== */
table{
  width:100%;
  background:#fff;
  border-radius:15px;
  overflow:hidden;
  margin-top:15px;
}
th,td{
  padding:10px;
  text-align:center;
}
th{
  background:#2196f3;
  color:#fff;
}
.total{
  color:#e91e63;
  font-weight:700;
}

/* ====== BUTTONS ====== */
button{
  padding:10px 18px;
  border:none;
  border-radius:12px;
  cursor:pointer;
}
.admin-btn{background:#e91e63;color:#fff}
.back-btn{background:#777;color:#fff}

/* ====== INPUTS ====== */
input,select{
  padding:8px;
  margin:4px;
  border-radius:8px;
}
</style>
</head>

<body>

<header>
  <h1>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø§ÙÙˆÙƒØ§ØªÙˆ</h1>
</header>

<!-- HOME -->
<div id="home" class="page active">
  <div class="groups">
    <div class="group" onclick="openGroup(0,this)">
      <i class="fa-solid fa-star"></i> Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
    </div>
    <div class="group" onclick="openGroup(1,this)">
      <i class="fa-solid fa-gem"></i> Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
    </div>
    <div class="group" onclick="openGroup(2,this)">
      <i class="fa-solid fa-crown"></i> Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
    </div>
    <div class="group" onclick="openGroup(3,this)">
      <i class="fa-solid fa-rocket"></i> Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©
    </div>
  </div>

  <br>
  <button class="admin-btn" onclick="openAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
</div>

<!-- STUDENTS -->
<div id="students" class="page">
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th><th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ù…Ø­Ø§Ø¶Ø±Ø§Øª</th><th>3 Ù…Ø­Ø§Ø¶Ø±Ø§Øª</th><th>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
      </tr>
    </thead>
    <tbody id="studentsTable"></tbody>
  </table>
  <br>
  <button class="back-btn" onclick="show('home')">Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ADMIN -->
<div id="admin" class="page">
  <select id="groupSelect" onchange="renderAdmin()">
    <option value="0">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
    <option value="1">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
    <option value="2">Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
    <option value="3">Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
  </select>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù…Ø­Ø§Ø¶Ø±Ø§Øª</th><th>3 Ù…Ø­Ø§Ø¶Ø±Ø§Øª</th><th>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
      </tr>
    </thead>
    <tbody id="adminTable"></tbody>
  </table>

  <h4>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</h4>
  <input id="nName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
  <input id="nl" type="number" placeholder="Ù…Ø­Ø§Ø¶Ø±Ø§Øª">
  <input id="nt" type="number" placeholder="3 Ù…Ø­Ø§Ø¶Ø±Ø§Øª">
  <input id="ng" type="number" placeholder="Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª">
  <br>
  <button class="admin-btn" onclick="addStudent()">Ø­ÙØ¸</button>
  <br><br>
  <button class="back-btn" onclick="show('home')">Ø±Ø¬ÙˆØ¹</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_kg1q6FdpfinZEAXU2AObu2yuAQmqElI",
  authDomain: "test-f8999.firebaseapp.com",
  databaseURL: "https://test-f8999-default-rtdb.firebaseio.com",
  projectId: "test-f8999"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ====== NAV ====== */
window.show = id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

/* ====== GROUPS ====== */
window.openGroup = (g,el)=>{
  document.querySelectorAll(".group").forEach(x=>x.classList.remove("selected"));
  el.classList.add("selected");

  const body=document.getElementById("studentsTable");
  onValue(ref(db,`students/group${g}`),(snap)=>{
    let arr=[];
    snap.forEach(c=>{
      const s=c.val();
      const total=(s.l||0)+(s.t||0)+(s.g||0);
      arr.push({...s,total});
    });
    arr.sort((a,b)=>b.total-a.total);
    body.innerHTML="";
    arr.forEach((s,i)=>{
      body.innerHTML+=`<tr>
        <td>${i+1}</td><td>${s.name}</td>
        <td>${s.l||0}</td><td>${s.t||0}</td><td>${s.g||0}</td>
        <td class="total">${s.total}</td>
      </tr>`;
    });
  });
  show("students");
};

/* ====== ADMIN SECURITY ====== */
let tries = +localStorage.getItem("tries") || 0;
let blockedUntil = +localStorage.getItem("blockedUntil") || 0;

window.openAdmin = ()=>{
  if(Date.now() < blockedUntil){
    alert("â›” Ø§Ù†Øª Ù…Ø­Ø¸ÙˆØ± Ù…Ø¤Ù‚ØªÙ‹Ø§");
    return;
  }

  const pass = prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

  if(pass === "6742981"){
    tries = 0;
    localStorage.setItem("tries",0);
    renderAdmin();
    show("admin");
  }else{
    tries++;
    localStorage.setItem("tries",tries);

    const msgs=[
      "ØºÙ„Ø· ğŸ˜…",
      "Ù„Ø³Ù‡ ØºÙ„Ø· ğŸ‘€",
      "Ø±ÙƒØ² Ø´ÙˆÙŠØ© ğŸ˜",
      "Ù‚Ø±Ø¨Øª ØªØªØ­Ø¸Ø± ğŸ˜‚",
      "Ø§ØªØ­Ø¸Ø±Øª 24 Ø³Ø§Ø¹Ø© â›”"
    ];

    alert(msgs[Math.min(tries-1,4)]);

    if(tries >= 5){
      blockedUntil = Date.now() + 24*60*60*1000;
      localStorage.setItem("blockedUntil",blockedUntil);
    }
  }
};

/* ====== ADMIN ====== */
window.renderAdmin = ()=>{
  const g=groupSelect.value;
  const body=document.getElementById("adminTable");

  onValue(ref(db,`students/group${g}`),(snap)=>{
    body.innerHTML="";
    snap.forEach(c=>{
      const s=c.val();
      const total=(s.l||0)+(s.t||0)+(s.g||0);
      body.innerHTML+=`<tr>
        <td>${s.name}</td>
        <td><input value="${s.l||0}" onchange="upd('${g}','${c.key}','l',this.value)"></td>
        <td><input value="${s.t||0}" onchange="upd('${g}','${c.key}','t',this.value)"></td>
        <td><input value="${s.g||0}" onchange="upd('${g}','${c.key}','g',this.value)"></td>
        <td class="total">${total}</td>
      </tr>`;
    });
  });
};

window.upd=(g,id,k,v)=>{
  update(ref(db,`students/group${g}/${id}`),{[k]:+v});
};

window.addStudent=()=>{
  const g=groupSelect.value;
  if(!nName.value.trim()) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…");
  push(ref(db,`students/group${g}`),{
    name:nName.value,
    l:+nl.value||0,
    t:+nt.value||0,
    g:+ng.value||0
  });
  nName.value=nl.value=nt.value=ng.value="";
};
</script>

</body>
</html>
